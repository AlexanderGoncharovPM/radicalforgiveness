<!-- –û–Ω–æ–≤–ª–µ–Ω–∞ HTML-—Ñ–æ—Ä–º–∞ –±—É–¥–µ –¥–æ–¥–∞–Ω–∞ –æ–∫—Ä–µ–º–∏–º –±–ª–æ–∫–æ–º, —â–æ –¥–∏–Ω–∞–º—ñ—á–Ω–æ –±—É–¥—É—î—Ç—å—Å—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø–∏—Ç–∞–Ω—å –∑ –ø—Ä–∏–º—ñ—Ç–∫–∞–º–∏ —Ç–∞ –ø—Ä–∏–∫–ª–∞–¥–∞–º–∏ -->
<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ê–Ω–∫–µ—Ç–∞ –†–∞–¥–∏–∫–∞–ª—å–Ω–æ–≥–æ –ü—Ä–æ—â–µ–Ω–Ω—è</title>
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: auto; padding: 2rem; }
    .question { margin-bottom: 2rem; }
    .hidden { display: none; }
    .progress { height: 20px; background: #eee; margin-bottom: 1rem; }
    .progress-bar { height: 100%; background: #4caf50; }
    label { display: block; margin-bottom: 0.5rem; font-weight: bold; }
    input[type=text], textarea { width: 100%; padding: 8px; margin-top: 0.5rem; }
    small.note {
      display: block;
      background-color: #e0f7fa;
      color: #007c91;
      padding: 10px;
      margin-top: 8px;
      border-left: 4px solid #00bcd4;
      border-radius: 4px;
      font-size: 0.95rem;
      line-height: 1.4;
    }
    small.example {
      display: block;
      background-color: #fdf6e3;
      color: #6b5000;
      padding: 8px;
      margin-top: 6px;
      border-left: 4px solid #e6c200;
      border-radius: 4px;
      font-size: 0.9rem;
      font-style: italic;
    }

    small.remark {
      display: block;
      background-color: #f3e5f5;
      color: #6a1b9a;
      padding: 10px;
      margin-top: 8px;
      border-left: 4px solid #ab47bc;
      border-radius: 4px;
      font-size: 0.95rem;
      line-height: 1.4;
    }
  .nav-btn {
  background: linear-gradient(135deg, #c3aed6, #f5c7b8);
  border: none;
  padding: 1.2rem 2.25rem;
  font-size: 1.65rem;
  border-radius: 12px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
  color: #2d0642;
  font-weight: bold;
  margin: 1rem 0.5rem;
  min-width: 180px;
}
@media (max-width: 600px) {
  .nav-btn {
    width: 100%;
    font-size: 1.8rem;
    padding: 1.2rem 2rem;
  }
}
</style>
<style>
  #music-btn {
    background-color: #f3e5f5;
    border: none;
    padding: 0.6rem 1.2rem;
    font-size: 1rem;
    cursor: pointer;
    border-radius: 8px;
    margin-bottom: 1.5rem;
  }
#music-controls {
  display: flex;
  gap: 1rem;
  margin-bottom: 1.5rem;
}
#music-controls button {
  font-size: 1.1rem;
  padding: 0.8rem 1.5rem;
  border-radius: 8px;
  margin-top: 1rem;
}
#music-controls button:hover {
  background: linear-gradient(135deg, #fbeaff, #ffe0e0);
  transform: scale(1.05);
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js">function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 20;
  doc.setFontSize(14);
  doc.text("–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è –∞–Ω–∫–µ—Ç–∏", 10, y);
  y += 10;
  if (answers.name) {
    doc.setFontSize(12);
    doc.text("–Ü–º‚Äô—è: " + answers.name, 10, y);
    y += 10;
  }
  const dateStr = new Date().toLocaleDateString("uk-UA");
  doc.text("–î–∞—Ç–∞ –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è: " + dateStr, 10, y);
  y += 10;
  doc.setFontSize(11);
  questions.forEach((q, i) => {
    const a = answers[q.id];
    if (a && y < 270) {
      doc.text(`${i + 1}. ${q.text.replace(/<[^>]*>/g, '').slice(0, 80)}`, 10, y);
      y += 6;
      const response = Array.isArray(a) ? a.join(", ") : a;
      const lines = doc.splitTextToSize(response, 180);
      lines.forEach(line => {
        doc.text(line, 12, y);
        y += 6;
        if (y > 270) doc.addPage(), y = 20;
      });
      y += 4;
    }
  });
  doc.save("–∞–Ω–∫–µ—Ç–∞.pdf");
}
</script>
</head>
<body>
<audio id="bgm" loop autoplay>
  <source src="videoplayback.weba" type="audio/webm">
  –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞—É–¥—ñ–æ.
</audio>
<div id="music-controls">
  <button id="music-btn" onclick="document.getElementById('bgm').play()">üéµ –£–≤—ñ–º–∫–Ω—É—Ç–∏ –º—É–∑–∏–∫—É</button>
  <button onclick="document.getElementById('bgm').pause()">üîá –í–∏–º–∫–Ω—É—Ç–∏ –º—É–∑–∏–∫—É</button>
</div>
  <h1>–ê–Ω–∫–µ—Ç–∞ –†–∞–¥–∏–∫–∞–ª—å–Ω–æ–≥–æ –ü—Ä–æ—â–µ–Ω–Ω—è</h1>
  <div class="progress"><div class="progress-bar" id="progressBar" style="width: 0%"></div></div>
  <form id="forgivenessForm">
    <div id="questionContainer"></div>
    <button type="button" id="prevBtn" class="nav-btn" onclick="changeStep(-1)">–ù–∞–∑–∞–¥</button>
    <button type="button" id="nextBtn" class="nav-btn" onclick="changeStep(1)">–î–∞–ª—ñ</button>
    <button type="submit" class="hidden" id="submitBtn">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
  </form>
  <div id="result" class="hidden">
  <button onclick="downloadPDF()" style="margin: 1rem 0; padding: 0.6rem 1.2rem; font-size: 1rem; border-radius: 8px; background: #673ab7; color: white; border: none;">‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PDF</button>
    <h2>–î—è–∫—É—î–º–æ –∑–∞ –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è!</h2>
    <p>–í–∞—à—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ.</p>
  </div>

  <script src="questions.js"></script>
<script>
let step = 0;
const answers = {};

function renderQuestion() {
  const q = questions[step];
  const container = document.getElementById("questionContainer");
  container.innerHTML = "";

  const value = (text) => text.replace(/\{\{name\}\}/g, answers.name || "...")
                               .replace(/\{\{target\}\}/g, answers.target || "...")
                               .replace(/\{\{real_emotions\}\}/g, answers.real_emotions || "...");

  const div = document.createElement("div");
  div.className = "question";

  const label = document.createElement("label");
  label.innerHTML = value(q.text);
  div.appendChild(label);

  if (q.type === "text") {
    const input = document.createElement("input");
    input.type = "text";
    input.name = q.id;
    input.value = answers[q.id] || "";
    input.oninput = (e) => (answers[q.id] = e.target.value);
    div.appendChild(input);
  } else if (q.type === "textarea") {
    const textarea = document.createElement("textarea");
    textarea.name = q.id;
    textarea.rows = 4;
    textarea.value = answers[q.id] || "";
    textarea.oninput = (e) => (answers[q.id] = e.target.value);
    div.appendChild(textarea);
  } else if (q.type === "radio" || q.type === "checkbox") {
    q.options.forEach((opt) => {
      const input = document.createElement("input");
      input.type = q.type;
      input.name = q.id;
      input.value = opt;
      input.checked = answers[q.id] === opt || (Array.isArray(answers[q.id]) && answers[q.id].includes(opt));
      input.onchange = (e) => {
        if (q.type === "checkbox") {
          answers[q.id] = answers[q.id] || [];
          if (e.target.checked) answers[q.id].push(opt);
          else answers[q.id] = answers[q.id].filter(o => o !== opt);
        } else {
          answers[q.id] = e.target.value;
        }
      };
      div.appendChild(input);
      div.appendChild(document.createTextNode(opt));
      div.appendChild(document.createElement("br"));
    });
  }

  if (q.hints_from && Array.isArray(q.hints_from)) {
    const hint = document.createElement("small");
    hint.className = "note";
    const filled = q.hints_from.map(k => answers[k]).filter(Boolean);
    hint.innerHTML = filled.length > 0
      ? "<strong>–ü—ñ–¥–∫–∞–∑–∫–∞:</strong> " + filled.join(", ")
      : "<em>–ü—ñ–¥–∫–∞–∑–∫–∞ –∑‚Äô—è–≤–∏—Ç—å—Å—è –ø—ñ—Å–ª—è –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π.</em>";
    div.appendChild(hint);
  }

  if (q.note) {
    const note = document.createElement("small");
    note.className = "note";
    note.className = "remark";
    note.innerHTML = value(q.note);
    div.appendChild(note);
  }

  if (q.example) {
    const ex = document.createElement("small");
    ex.className = "example";
    ex.innerHTML = "<strong>–ù–∞–ø—Ä–∏–∫–ª–∞–¥:</strong> " + value(q.example);
    div.appendChild(ex);
  }

  container.appendChild(div);
  document.getElementById("prevBtn").style.display = step === 0 ? "none" : "inline";
  document.getElementById("nextBtn").style.display = step === questions.length - 1 ? "none" : "inline";
  document.getElementById("submitBtn").classList.toggle("hidden", step !== questions.length - 1);
  document.getElementById("progressBar").style.width = `${((step + 1) / questions.length) * 100}%`;
}

function changeStep(delta) {
  step += delta;
  renderQuestion();
}

document.getElementById("forgivenessForm").onsubmit = (e) => {
    const value = function(text) {
    return text.replace(/\{\{(\w+)\}\}/g, (_, key) => answers[key] || "...");
  };

  e.preventDefault();
  document.getElementById("forgivenessForm").classList.add("hidden");
  document.getElementById("result").classList.remove("hidden");

  let html = `<html><head><meta charset='utf-8'><title>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ê–Ω–∫–µ—Ç–∏</title><style>body{font-family:sans-serif;padding:2rem;}h2{color:#4caf50;}hr{margin:2rem 0;}p{margin-bottom:1rem;}</style></head><body>`;
  html += `<h2>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è –∞–Ω–∫–µ—Ç–∏</h2>`;

  if (answers.name) {
    html += `<p><strong>–Ü–º‚Äô—è:</strong> ${answers.name}</p>`;
  }

  const dateStr = new Date().toLocaleDateString("uk-UA");
  html += `<p><strong>–î–∞—Ç–∞ –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è:</strong> ${dateStr}</p><hr />`;

  questions.forEach((q, i) => {
    const a = answers[q.id];
    if (a) {
      html += `<div style="display: flex; gap: 1rem; margin-bottom: 1rem;">`;
      html += `<div style="flex: 1; font-weight: bold;">${i + 1}. ${value(q.text).replace(/<[^>]*>/g, '')}</div>`;
      html += `<div style="flex: 1;">${Array.isArray(a) ? a.join(", ") : a}</div>`;
      html += `</div>`;
    }
  });

  html += `<hr /><p><em>–î—è–∫—É—î–º–æ –∑–∞ –≤–∞—à—É –≥–ª–∏–±–æ–∫—É –≤–Ω—É—Ç—Ä—ñ—à–Ω—é —Ä–æ–±–æ—Ç—É.</em><br/>–¶–µ–π –∑–≤—ñ—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ –≤–∞–º–∏ ‚Äî –¥–ª—è —Å–µ–±–µ.</p>`;
  html += `</body></html>`;

  const newTab = window.open();
  newTab.document.write(html);
  newTab.document.close();
};

renderQuestion();
</script>

</body>
</html>
